# WP Vite Assets

## Quick Start

### Vite Config

```js
import { defineConfig } from "vite";
import FullReload from "vite-plugin-full-reload"; // optional plugin

export default defineConfig({
	// optional: reload on php change
	plugins: [FullReload(["**/*.php"])],
	build: {
		// required: generate .vite/manifest.json in outDir
		manifest: true,
		// required: overwrite default .html entry with your actual entries
		rollupOptions: {
			input: ["src/main.js", "src/style.css"],
		},
	},
});
```

### WordPress Plugin (or theme)

```php
$base_url      = plugin_dir_url( __FILE__ ) . 'dist/';
$dev_url       = 'http://localhost:5173';
$manifest_path = __DIR__ . '/dist/.vite/manifest.json';
$plugin_prefix = '@my-plugin';

$assets = new WP_Vite_Assets( $plugin_prefix, $manifest_path, $base_url, $dev_url );

// enqueue your entry files, with optional customizations:

// enqueue script moduled with a handle of "@my-plugin/main"
$assets->enqueue( 'src/main.js' );

// enqueue stylesheet with a handle of "@my-plugin/all"
$assets->enqueue(
	'src/style.css',
	array(
		'handle'  => 'all',
	)
);
```

## API

### \_\_construct( $prefix, $manifest_path, $base_url, $dev_url )

- `$prefix` (string) - namespace for handles defined for enqueued assets, typically `@` followed by the name of the plugin or theme
- `$manifest_path` (string) - File path on the server to the manifest file generated by Vite
- `$base_url` (string) - Front-end URL directory where the build files live
- `$dev_url` (string) - Domain of the dev server provided by Vite

### enqueue( $entry_file_path, $args = array() )

Main function to enqueue entry files. Can also provide additional options to customize how it is enqueued

- `$entry_file_path` (string) - relative path from project root to file
- `$args` - additional options to customize the enqueued file:
  - `'handle'` (string) - custom suffix for the enqueued item. Defaults to `name` provided by Vite, or else filename.
  - `'deps'` (array) - Additional registered assets this file depends upon. Used to list external JS/CSS from other plugins or themes that are not managed with this Vite instance
  - `'module'` (boolean) - Only applies to `.js` files. Whether to enqueue as a module or plain script. Defaults to `true`.
  - `'wp_args'` (array) - Only applies to `.js` files with `'module' => false`. Array of options forwarded to `wp_enqueue_script()`

## Additional Examples

### Enqueue non-module JS

In rare cases you may need to load a traditional script in the head of the page.

Note that modules cannot be loaded in the head, which is a limitation of the `wp_enqueue_script_module` function provided by WordPress.

```php
$assets->enqueue( 'src/main.js', array(
	'module' => false,
	'wp_args' => array(
		'in_footer' => false // optionally, use WP option to load in head
	),
) );
```

### Bundled JS and CSS

`src/main.js`:

```js
import "./my-styles.css";

console.log("do something in js");
```

`plugin.php`:

```php
$assets->enqueue( 'src/main.js' );
// CSS is automatically enqueued as well
```

`import`ed styles will automatically be enqueued when the JS entry file is enqueued. Note when dev server is running Vite will inject styles imported in JS as inline `<style>` tag instead, so CSS files are not enqueued separately.

## Resources and Insipration

- https://vite.dev/guide/backend-integration.html
- https://gist.github.com/chrispage1/06ac44ac3c01ab0454a935d50b8c9282
- https://github.com/idleberg/php-wordpress-vite-assets
